<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<noscript>Your browser does not support JavaScript!</noscript>

<head>
    <title>Color Code</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="./js/ColorGenerator.js"></script>
</head>

<body>
    <textarea id="codeinput" style="height: 100px; width: 100%; margin: 0 auto;" onchange="applyColors()"
        placeholder="写点什么"></textarea>
    <input type="color" id="firstcolor" onchange="changeColorFirst()">
    <span>----</span>
    <input type="color" id="lastcolor" onchange="applyColors()">
    <span>渐变：</span><select id="colorType" onchange="applyColors()">
        <option value="RGB">RGB</option>
        <option value="HSV" selected>HSV</option>
    </select>
    <span>选择Code格式：</span><select id="codeType" onchange="applyColors()">
        <option value="[color=%%color]%%words[/color]" selected>[color=#FFFFFF]文字[/color]</option>
        <option value="<color=%%color>%%words</color>">&lt;color=#FFFFFF&gt;文字&lt;/color&gt;</option>
    </select>
    <br>
    <span>预览：</span>
    <div id="preview" style="height: auto; width: 100%; margin: 0 auto;"></div>
    <span>代码：</span><textarea id="codeoutput" style="height: 100px; width: 100%; margin: 0 auto;" readonly></textarea>

    <script>
        function applyColors() {
            const texts = document.getElementById("codeinput").value.trim();
            const firstcolor = new Color(document.getElementById("firstcolor").value);
            const lastcolor = new Color(document.getElementById("lastcolor").value);
            const colorType = document.getElementById("colorType").value;
            if (texts.indexOf("\n") < 0) {
                const cg = new ColorGenerator(texts, firstcolor, lastcolor);
                const result = cg.applyColors(colorType);
                preview(result.words, result.colors);
                createCode(result.words, result.colors);
            }
            else {
                // multi line
                // find the longest line
                const lines = texts.split("\n");
                const widths = lines.map((line) => line.length);
                const maxlength = Math.max(...widths);
                let results = lines.map((line) => {
                    const cg = new ColorGenerator(line, firstcolor, lastcolor);
                    return cg.applyColors(colorType, maxlength);
                })
                let words = [];
                let colors = [];
                results.map((result) => {
                    words.push(...result.words);
                    colors.push(...result.colors);
                    words.push("\n");
                    colors.push("#FFFFFF");
                });
                preview(words, colors);
                createCode(words, colors);
            }
        }


        function preview(words, colors) {

            let spans = [];
            words.map((word, index) => {
                if (word === "\n") spans[index] = "<br>";
                else if (word === " ") spans[index] = "<span> </span>";
                else spans[index] = "<span style='color:" + colors[index] + ";'>" + word + "</span>";
            });
            document.getElementById("preview").innerHTML = spans.join("");
        }

        function createCode(words, colors) {
            let codeTypeEle = document.getElementById("codeType");
            let codeType = codeTypeEle.options[codeTypeEle.selectedIndex].value;
            let code = [];
            words.map((word, index) => {
                if (word === "\n") code[index] = "\n";
                else if (word === " ") code[index] = " ";
                else code[index] = codeType.replace("%%color", colors[index]).replace("%%words", word);
            });
            document.getElementById("codeoutput").value = code.join("");
        }

        function changeColorFirst() {
            let firstcolor = document.getElementById("firstcolor").value;
            document.getElementById("lastcolor").value = firstcolor;
            applyColors();
        }

        function test() {
            document.getElementById("codeinput").value = "HELLO WORLD\nHAPPY EVERYDAY\nTO YOU"
            document.getElementById("firstcolor").value = "#fe12ef";
            document.getElementById("lastcolor").value = "#21feef";
            applyColors();
        }

        test();
    </script>

</body>

</html>